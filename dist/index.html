<!DOCTYPE html>
<html lang="en">
<html class='use-all-space'>
<head>
    <meta http-equiv='X-UA-Compatible' content='IE=Edge' />
    <meta charset='UTF-8'>
    <title>Discover The Traffic</title>
    <meta name='viewport'
          content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.12.0/maps/maps.css'>
    <link rel='stylesheet' type='text/css' href='../assets/ui-library/index.css' />
    <link rel='stylesheet' type='text/css' href='../assets/ui-library/icons-css/routing.css' />
    <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/plugins/SearchBox/3.1.11//SearchBox.css' />
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://img.icons8.com/flat-round/64/000000/traffic-light--v1.png" type="image/x-icon" />
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.36.1/maps/maps-web.min.js"></script>
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.36.1/services/services-web.min.js"></script>
    
</head>

<style>
    #foldable {
        width: 320px;
    }

    #form {
        margin-top: 10px;
    }

    .tt-icon-size {
        height: 18px !important;
        width: 18px !important;
    }

    .icon-spacing-right {
        margin-right: 17px;
        margin-top: 22px;
    }

    .icon-spacing-left {
        margin-left: 12px;
        margin-top: 24px;
    }

    .route-input-container {
        display: flex;
    }

    button.add-stop-btn {
        margin-left: 30px;
        margin-top: 24px;
    }

    .remove-btn {
        background-color: transparent;
        border: 0;
    }

        .remove-btn.hidden {
            visibility: hidden;
        }

    .waypoint-marker {
        align-items: center;
        background-color: #4a90e2;
        border: solid 3px #2faaff;
        border-radius: 50%;
        color: #ffffff;
        display: flex;
        font-size: 14px;
        font-weight: bold;
        height: 32px !important;
        justify-content: center;
        text-align: center;
        width: 32px !important;
        will-change: unset !important;
    }

    .tt-icon-number {
        align-items: center;
        background: #ffffff;
        background-color: #8dc3eb;
        border-radius: 50%;
        color: #ffffff;
        display: flex;
        justify-content: center;
        margin-right: 14px;
        padding: 8px;
    }

    .tt-search-box-input {
        width: calc(100% - 15px) !important;
    }

        .map-view .icon {
            height: 30px;
            width: 30px;
        }
        .map-view .tt-icon.-finish {
            height: 16px;
            width: 16px;
        }
        .map-view .icon-spacing {
            margin-right: 14px;
            margin-top: 24px;
        }
        .map-view .searchbox {
            flex: 1;
        }
        .map-view .searchbox-wrapper {
            display: flex;
            min-height: 52px;
        }
        .map-view .draggable-marker {
            align-items: center;
            background-color: #4a90e2;
            border: solid 3px #2faaff;
            border-radius: 50%;
            display: flex;
            height: 32px;
            justify-content: center;
            transition: width .1s, height .1s;
            width: 32px;
        }
        .summary-header {
            border-bottom: 1px solid #f2f2f2;
            font-size: 16px;
            font-weight: bold;
            padding: 24px;
        }
        .summary-details-top {
            font-size: 16px;
            font-weight: bold;
            padding: 24px 24px 0;
        }
        .summary-details-bottom {
            display: flex;
        }
        .summary-icon-wrapper {
            padding: 24px;
            width: 98px;
        }
        .summary-details-text {
            padding: 24px 24px 24px 0;
            width: calc(100% - 98px);
        }
        .summary-details-info {
            display: block;
            font-size: 12px;
            margin-top: 5px;
        }
        .summary-details-info.-second {
            margin-top: 10px;
        }
        .tt-icon.-car {
            height: 50px !important;
            width: 50px !important;
        }
    }

</style>

<body>
<!-- Header -->
    <section id="header">
        <div class="header container">
            <div class="nav-bar">
                <div class="brand">
                    <a href="#hero">
                        <h1><span>G</span>et that Quatro <span>B</span>ro</h1>
                    </a>
                </div>
                <div class="nav-list">
                    <div class="hamburger">
                        <div class="bar"></div>
                    </div>
                    <ul>
			<li><a href="Home.html" data-after="Home">Home</a></li>
                        <li><a href="weather.html" data-after="Home">WeatherMap</a></li>

                    </ul>
                </div>
            </div>
        </div>
    </section>
<!-- Projects Section -->
    <section id="projects">
        <div class="projects-header">
            <h1 class="section-title">Traffic <span>Flow</span></h1>
        </div>
        <div class="projects container">
            <div class="project-item">
                <script type='text/javascript' src='../assets/js/tail.select.min.js'></script>
                <div id='map' class='map'>
                    <div id='foldable' class='tt-overlay-panel -left-top -medium js-foldable'>
                        <div id='form'>
                            <div class='map-view'>
                              
                                    <form class='tt-side-panel js-form'>
                                        <header class='tt-side-panel__header'>
                                            <div class="searchbox-wrapper">
                                                <div class='tt-icon icon-spacing -start'></div>
                                                <div id='startSearchBox' class='tt-form-label searchbox'></div>
                                            </div>
                                            <div class="searchbox-wrapper">
                                                <div class='tt-icon icon-spacing -finish'></div>
                                                <div id='finishSearchBox' class='tt-form-label searchbox'></div>
                                            </div>
                                            <div id='form'>
                                                <div id='searchBoxesPlaceholder' class='tt-form-label'>
                                                    <div class='tt-spacing-top-24'>
                                                        <label class='tt-form-label'>Traffic layers</label>
                                                        <input type='checkbox' class='tt-checkbox' id='incidents' checked='true'>
                                                        <label class='tt-label' for="incidents">Incidents</label>
                                                        <input type='checkbox' class='tt-checkbox' id='flow' checked='true'>
                                                        <label class='tt-label' for="flow">Flow</label>
                                                        <div class='tt-overlay-panel -center js-message-box' hidden>
                                                            <button class='tt-overlay-panel__close js-message-box-close'></button>
                                                            <span class='tt-overlay-panel__content'></span>
                                                        </div>
                                                    </div>
                                                </div>
                				
                                            </div>
	
                                        </header>
                                        <div class='tt-tabs js-tabs'>
                                            <div class='tt-tabs__panel'>
                                                <div class='tt-results-list js-results'></div>
                                                <div class='js-results-loader' hidden='hidden'>
                                                    <div class='loader-center'><span class='loader'></span></div>
                                                </div>
                                                <div class='tt-tabs__placeholder js-results-placeholder -small'>
                                                    For results choose starting and destination points.
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <div id='map' class='full-map'></div>
                               
                            </div>
                        </div>
                    </div>
                </div>
                <script src='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.12.0/maps/maps-web.min.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/mobile-or-tablet.js'></script>
                <script src='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.12.0/services/services-web.min.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/foldable.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/info-hint.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/formatters.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/search/dom-helpers.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/search/results-manager.js'></script>
                <script data-showable type='text/javascript' src='../assets/js/search/searchbox-enter-submit.js'></script>
                <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'></script>

		<script src='currentWeatherData.js'></script>
<script src='https://api.tomtom.com/maps-sdk-for-web/cdn/plugins/SearchBox/3.1.11//SearchBox-web.js'></script>
                
<script>
                    var MAX_ROUTING_INPUTS = 7;
                    var map = tt.map({
                        key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC',
                        container: 'map',
                        dragPan: !isMobileOrTablet(),
                        stylesVisibility: {
                            trafficIncidents: true,
                            trafficFlow: true,
                        }
                    });
                    var routeMarkers = {}, routePoints = {}, searchBoxes = {};
                    var finishMarkerElement = createMarkerElement('finish');
                    var startMarkerElement = createMarkerElement('start');
                    var errorHint = new InfoHint('error', 'bottom-center', 5000).addTo(document.getElementById('map'));
                    var loadingHint = new InfoHint('info', 'bottom-center').addTo(document.getElementById('map'));
                    var resultsManager = new ResultsManager();
                    var detailsWrapper = document.createElement('div');
                    var summaryContent = document.createElement('div'), summaryHeader;

                 
                    
                    map.on('load', function() {
                        searchBoxes.start = createSearchBox('start');
                        searchBoxes.finish = createSearchBox('finish');
                    });
 

                    function addRouteMarkers(type, point) {
                        var lngLat = point && point[type + 'Point'] || routePoints[type];

                        if (!routeMarkers[type] && routePoints[type]) {
                            routeMarkers[type] = createMarker(type, lngLat);
                        }
                        if (routeMarkers[type]) {
                            routeMarkers[type].setLngLat(routePoints[type]);
                        }
                    }

                    function centerMap(lngLat) {
                        map.flyTo({
                            center: lngLat,
                            speed: 10,
                            zoom: 8
                        });
                    }

                    function clearMap() {
                        if (!map.getLayer('route')) {
                            return;
                        }
                        map.removeLayer('route');
                        map.removeSource('route');
                    }

                    function createMarker(type, lngLat) {
                        var markerElement = type === 'start' ? startMarkerElement : finishMarkerElement;

                        return new tt.Marker({ draggable: true, element: markerElement })
                            .setLngLat(lngLat || routePoints[type])
                            .addTo(map)
                            .on('dragend', getDraggedMarkerPosition.bind(null, type));
                    }

                    function createMarkerElement(type) {
                        var element = document.createElement('div');
                        var innerElement = document.createElement('div');

                        element.className = 'draggable-marker';
                        innerElement.className = 'tt-icon -white -' + type;
                        element.appendChild(innerElement);
                        return element;
                    }

                    function createSearchBox(type) {
                        var searchBox = new tt.plugins.SearchBox(tt.services, {
                            showSearchButton: false,
                            searchOptions: {
                                key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC'
                            },
                            labels: {
                                placeholder: 'Query e.g. Washington'
                            }
                        });

                        document.getElementById(type + 'SearchBox').appendChild(searchBox.getSearchBoxHTML());
                        searchBox.on('tomtom.searchbox.resultscleared', onResultCleared.bind(null, type));

                        searchBox.on('tomtom.searchbox.resultsfound', function(event) {
                            handleEnterSubmit(event, onResultSelected.bind(this), errorHint, type);
                        });

                        searchBox.on('tomtom.searchbox.resultselected', function(event) {
                            if (event.data && event.data.result) {
                                onResultSelected(event.data.result, type);
                            }
                        });

                        return searchBox;
                    }

                    function createSummaryContent(feature) {
                        if (!summaryHeader) {
                            summaryHeader = DomHelpers.elementFactory('div', 'summary-header', 'Route summary');
                            summaryContent.appendChild(summaryHeader);
                        }
                        var detailsHTML =
                            '<div class="summary-details-top">Leave now</div>' +
                            '<div class="summary-details-bottom">' +
                                '<div class="summary-icon-wrapper">' +
                                    '<span class="tt-icon -car -big"></span>' +
                                '</div>' +
                                '<div class="summary-details-text">' +
                                    '<span class="summary-details-info">Distance: <b>' +
                                        Formatters.formatAsMetricDistance(feature.lengthInMeters) +
                                    '</b></span>' +
                                    '<span class="summary-details-info -second">Arrive: <b>' +
                                        Formatters.formatToExpandedDateTimeString(feature.arrivalTime) +
                                    '</b></span>' +
                                '</div>' +
                            '</div>';

                        detailsWrapper.innerHTML = detailsHTML;
                        summaryContent.appendChild(detailsWrapper);
                        return summaryContent;
                    }

                    function getDraggedMarkerPosition(type) {
                        var lngLat = routeMarkers[type].getLngLat();

                        performReverseGeocodeRequest(lngLat)
                            .then(function(response) {
                                var addresses = response.addresses[0];
                                var freeFormAddress = addresses.address.freeformAddress;

                                if (!freeFormAddress) {
                                    loadingHint.hide();
                                    clearMap();
                                    resultsManager.resultsNotFound();
                                    errorHint.setMessage('Address not found, please choose a different place');
                                    return;
                                }
                                searchBoxes[type]
                                    .getSearchBoxHTML()
                                    .querySelector('input.tt-search-box-input')
                                    .value = freeFormAddress;
                                var position = {
                                    lng: addresses.position.lng,
                                    lat: addresses.position.lat
                                };

                                updateMapView(type, position);
                            });
                    }

                    function handleCalculateRouteError() {
                        clearMap();
                        resultsManager.resultsNotFound();
                        errorHint.setMessage('There was a problem calculating the route');
                        loadingHint.hide();
                    }

                    function handleCalculateRouteResponse(response, type) {
                        var geojson = response.toGeoJson();
                        var coordinates = geojson.features[0].geometry.coordinates;

                        clearMap();
                        map.addLayer({
                            'id': 'route',
                            'type': 'line',
                            'source': {
                                'type': 'geojson',
                                'data': geojson
                            },
                            'paint': {
                                'line-color': '#4a90e2',
                                'line-width': 6
                            }
                        });
                        var bounds = new tt.LngLatBounds();
                        var point = {
                            startPoint: coordinates[0],
                            finishPoint: coordinates.slice(-1)[0]
                        };
                        addRouteMarkers(type, point);
                        resultsManager.success();
                        resultsManager.append(createSummaryContent(geojson.features[0].properties.summary));
                        coordinates.forEach(function(point) {
                            bounds.extend(tt.LngLat.convert(point));
                        });
                        map.fitBounds(bounds, { duration: 0, padding: 50 });
                        loadingHint.hide();
                    }

                    function handleDrawRoute(type) {
                        errorHint.hide();
                        loadingHint.setMessage('Loading...');
                        resultsManager.loading();
                        performCalculateRouteRequest()
                            .then(function(response) {
                                handleCalculateRouteResponse(response, type);
                            })
                            .catch(handleCalculateRouteError);
                    }

                    function onResultCleared(type) {
                        routePoints[type] = null;
                        if (routeMarkers[type]) {
                            routeMarkers[type].remove();
                            routeMarkers[type] = null;
                        }
                        if (shouldDisplayPlaceholder()) {
                            resultsManager.resultsNotFound();
                        }
                        if (routePoints.start || routePoints.finish) {
                            var lngLat = type === 'start' ? routePoints.finish : routePoints.start;
                            clearMap();
                            centerMap(lngLat);
                        }
                    }

                    function onResultSelected(result, type) {
                        var position = result.position;

                        updateMapView(type, position);
                    }

                    function performCalculateRouteRequest() {
                        return tt.services.calculateRoute({
                            key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC',
                            traffic: false,
                            locations: routePoints.start.join() + ':' + routePoints.finish.join()
                        });
                    }

                    function performReverseGeocodeRequest(lngLat) {
                        return tt.services.reverseGeocode({
                            key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC',
                            position: lngLat
                        });
                    }

                    function shouldDisplayPlaceholder() {
                        return !(routePoints.start && routePoints.finish);
                    }

                    function updateMapView(type, position) {
                        routePoints[type] = [position.lng, position.lat];
                        if (routePoints.start && routePoints.finish) {
                            handleDrawRoute(type);
                        } else {
                            addRouteMarkers(type);
                            centerMap(routePoints[type]);
                        }
                    }
                    //bind events
                    document.querySelector('#flow').addEventListener('change', function (event) {
                        if (event.target.checked) {
                            map.showTrafficFlow();
                        } else {
                            map.hideTrafficFlow();
                        }
                    });

                    document.querySelector('#incidents').addEventListener('change', function (event) {
                        if (event.target.checked) {
                            map.showTrafficIncidents();
                        } else {
                            map.hideTrafficIncidents();
                        }
                    });
                    map.addControl(new tt.FullscreenControl());
                    map.addControl(new tt.NavigationControl());
                    new Foldable('#foldable', 'top-right');
                    var routingInputs = [];
                    var route;
                    var markers = [];
                    var errorHint = new InfoHint('error', 'bottom-center', 5000).addTo(document.getElementById('map'));
                    var loadingHint = new InfoHint('info', 'bottom-center').addTo(document.getElementById('map'));

                    function RoutingService() {

                    }

                    RoutingService.prototype.calculateRoute = function () {
                        this.clearMarkers();
                        if (route) {
                            map.removeLayer('route');
                            map.removeSource('route');
                            route = undefined;
                        }
                        var locations = this.getLocations();
                        this.drawMarkers(locations.arr);
                        if (locations.count < 2) {
                            return;
                        }
                        loadingHint.setMessage('Loading...');
                        tt.services.calculateRoute({
                            key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC',
                            traffic: false,
                            locations: locations.str
                        })
                            .then(function (response) {
                                loadingHint.hide();
                                this.clearMarkers();
                                var geojson = response.toGeoJson();
                                route = map.addLayer({
                                    'id': 'route',
                                    'type': 'line',
                                    'source': {
                                        'type': 'geojson',
                                        'data': geojson
                                    },
                                    'paint': {
                                        'line-color': '#2faaff',
                                        'line-width': 6
                                    }
                                }, this.findFirstBuildingLayerId());

                                var coordinates = geojson.features[0].geometry.coordinates;
                                if (geojson.features[0].properties.segmentSummary.length > 1) {
                                    coordinates = [].concat.apply([], coordinates);
                                }

                                this.updateRoutesBounds(coordinates);
                                this.drawMarkers(locations.arr);
                            }.bind(this))
                            .catch(function (error) {
                                loadingHint.hide();
                                errorHint.setErrorMessage(error);
                            });
                    };

                    RoutingService.prototype.clearMarkers = function () {
                        markers.forEach(function (marker) {
                            marker.remove();
                        });
                    };

                    RoutingService.prototype.drawMarkers = function (locations) {
                        var bounds = new tt.LngLatBounds();
                        var maxIndex = routingInputs.length - 1;
                        if (locations.length === 0) {
                            return;
                        }

                        routingInputs.forEach(function (input, index) {
                            if (input.position) {
                                var marker = new tt.Marker(this.waypointMarker(index, maxIndex)).setLngLat(input.position).addTo(map);
                                markers.push(marker);
                                bounds.extend(tt.LngLat.convert(input.position));

                                if (input.viewport) {
                                    input.viewport.forEach(function (viewport) {
                                        bounds.extend(tt.LngLat.convert(viewport));
                                    });
                                }
                            }
                        }, this);
                        map.fitBounds(bounds, { duration: 0, padding: 100 });
                    };

                    RoutingService.prototype.findFirstBuildingLayerId = function () {
                        var layers = map.getStyle().layers;
                        for (var index in layers) {
                            if (layers[index].type === 'fill-extrusion') {
                                return layers[index].id;
                            }
                        }

                        throw new Error('Map style does not contain any layer with fill-extrusion type.');
                    };

                    RoutingService.prototype.getLocations = function () {
                        var resultStr = '';
                        var resultArr = [];
                        var count = 0;
                        routingInputs.forEach(function (routingInput) {
                            if (routingInput.position) {
                                count += 1;
                                resultArr.push(routingInput.position);
                                resultStr += routingInput.position.lng + ',' + routingInput.position.lat + ':';
                            }
                        });
                        resultStr = resultStr.substring(0, resultStr.length - 1);
                        return {
                            str: resultStr,
                            count: count,
                            arr: resultArr
                        };
                    };

                    RoutingService.prototype.waypointMarker = function (index, total) {
                        var container = document.createElement('div');
                        container.className = 'waypoint-marker';
                        if (index === 0) {
                            container.className += ' tt-icon -start -white';
                        } else if (index === total) {
                            container.className += ' tt-icon -finish -white';
                        } else {
                            var number = document.createElement('div');
                            number.innerText = index;
                            container.appendChild(number);
                        }
                        return container;
                    };

                    RoutingService.prototype.updateRoutesBounds = function (coordinates) {
                        var bounds = new tt.LngLatBounds();

                        coordinates.forEach(function (point) {
                            bounds.extend(tt.LngLat.convert(point));
                        });

                        if (!bounds.isEmpty()) {
                            map.fitBounds(bounds, { duration: 0, padding: 100 });
                        }
                    };

                    function RoutingInput(options) {
                        this.index = options.index;
                        this.routingService = options.routingService;
                        this.onRemoveBtnClick = options.onRemove.bind(this);
                        this.container = this.createContainer();
                        this.searchBox = this.createSearchBox();
                        this.icon = this.createIconContainer();
                        this.removeButton = this.createRemoveButton();
                        this.container.appendChild(this.icon);
                        this.container.appendChild(this.searchBox);
                        this.container.appendChild(this.removeButton);
                    }

                    RoutingInput.prototype.createContainer = function () {
                        var container = document.createElement('div');
                        container.className = 'route-input-container';
                        return container;
                    };

                    RoutingInput.prototype.createSearchBox = function () {
                        var searchBox = new tt.plugins.SearchBox(tt.services, {
                            showSearchButton: false,
                            searchOptions: {
                                key: 'WSE9tPCgtbTd6ckjrtGxtQyeflZiE9dC'
                            },
                            labels: {
                                placeholder: 'Query e.g. Washington'
                            }
                        });
                        var htmlSearchBox = searchBox.getSearchBoxHTML();
                        document.getElementById('searchBoxesPlaceholder').appendChild(htmlSearchBox);
                        searchBox.on('tomtom.searchbox.resultscleared', this.onResultCleared.bind(this));

                        searchBox.on('tomtom.searchbox.resultsfound', function (event) {
                            handleEnterSubmit(event, this.onResultSelected.bind(this), errorHint);
                        }.bind(this));

                        searchBox.on('tomtom.searchbox.resultselected', function (event) {
                            if (event.data && event.data.result) {
                                this.onResultSelected(event.data.result);
                            }
                        }.bind(this));

                        return htmlSearchBox;
                    };

                    RoutingInput.prototype.getIconType = function () {
                        var lastIdx = routingInputs.length - 1;
                        switch (this.index) {
                            case 0:
                                return 'start';
                            case lastIdx:
                                return 'finish';
                            default:
                                return 'number';
                        }
                    };

                    RoutingInput.prototype.getIconClassName = function (iconType) {
                        switch (iconType) {
                            case 'start':
                                return 'tt-icon tt-icon-size icon-spacing-right -start';
                            case 'finish':
                                return 'tt-icon tt-icon-size icon-spacing-right -finish';
                            case 'number':
                                return 'tt-icon-number tt-icon-size icon-spacing-right icon-number';
                        }
                    };

                    RoutingInput.prototype.createRemoveButton = function () {
                        var button = document.createElement('button');
                        button.className = 'tt-icon icon-spacing-left remove-btn -trash';
                        button.onclick = function (event) {
                            event.preventDefault();
                            this.container.parentNode.removeChild(this.container);
                            routingInputs.splice(this.index, 1);
                            this.onRemoveBtnClick();
                        }.bind(this);
                        return button;
                    };

                    RoutingInput.prototype.createIconContainer = function () {
                        var icon = document.createElement('div');
                        return icon;
                    };

                    RoutingInput.prototype.updateIcons = function () {
                        var icon = document.createElement('div');
                        var iconType = this.getIconType();
                        icon.className = this.getIconClassName(iconType);

                        if (iconType === 'number') {
                            var number = document.createElement('div');
                            number.innerText = this.index;
                            icon.appendChild(number);
                        }

                        this.container.replaceChild(icon, this.icon);
                        this.icon = icon;
                        if (routingInputs.length <= 2) {
                            this.removeButton.classList.add('hidden');
                        } else {
                            this.removeButton.classList.remove('hidden');
                        }
                    };

                    RoutingInput.prototype.onResultCleared = function () {
                        this.position = undefined;
                        this.viewport = undefined;
                        this.routingService.calculateRoute();
                    };

                    RoutingInput.prototype.onResultSelected = function (result) {
                        this.position = result.position;
                        this.viewport = [result.viewport.topLeftPoint, result.viewport.btmRightPoint];
                        this.routingService.calculateRoute();
                    };

                    function Panel(routingService) {
                        this.routingService = routingService;
                        this.container = document.getElementById('form');
                        this.createInput();
                        this.createInput();
                        this.createAddButton();
                    }

                    Panel.prototype.createWaypoint = function () {
                        var length = routingInputs.length;
                        if (length === MAX_ROUTING_INPUTS) {
                            errorHint.setMessage('You cannot add more waypoints in this example, but ' +
                                'the Routing service supports up to 150 waypoints.');
                            return;
                        }
                        var index = length - 1;
                        var routingInput = this.createRoutingInput(index);
                        this.container.insertBefore(routingInput.container, routingInputs[length - 1].container);
                        routingInputs.splice(index, 0, routingInput);
                        this.updateRoutingInputIndexes();
                        this.updateRoutingInputIcons();
                    };

                    Panel.prototype.createRoutingInput = function (index) {
                        return new RoutingInput({
                            index: index,
                            onRemove: this.onRemoveBtnClick.bind(this),
                            routingService: this.routingService
                        });
                    };

                    Panel.prototype.createInput = function () {
                        var index = routingInputs.length;
                        var routingInput = this.createRoutingInput(index);
                        this.container.appendChild(routingInput.container);
                        routingInputs.push(routingInput);
                        routingInput.updateIcons();
                    };

                    Panel.prototype.createAddButton = function () {
                        var button = document.createElement('button');
                        button.appendChild(document.createTextNode('ADD STOP'));
                        button.className = 'tt-button -primary add-stop-btn';
                        button.onclick = function (event) {
                            event.preventDefault();
                            this.createWaypoint();
                        }.bind(this);
                        this.container.appendChild(button);
                    };

                    Panel.prototype.onRemoveBtnClick = function () {
                        this.updateRoutingInputIndexes();
                        this.updateRoutingInputIcons();
                        this.routingService.calculateRoute();
                    };

                    Panel.prototype.updateRoutingInputIndexes = function () {
                        routingInputs.forEach(function (routingInput, index) {
                            routingInput.index = index;
                        });
                    };

                    Panel.prototype.updateRoutingInputIcons = function () {
                        routingInputs.forEach(function (routingInput) {
                            routingInput.updateIcons();
                        });
                    };


                    var routingService = new RoutingService();
                    map.on('load', function () {
                        routingService.calculateRoute();
                    });

                    new Panel(routingService);
                    var messageBox = document.querySelector('.js-message-box');
                    var messageBoxContent = document.querySelector('.tt-overlay-panel__content');
                    var messageBoxClose = messageBox.querySelector('.js-message-box-close');

                    var messages = {
                        permissionDenied: 'Permission denied. You can change your browser settings' +
                            'to allow usage of geolocation on this domain.',
                        notAvailable: 'Geolocation data provider not available.'
                    };
                    // Create plugin instance
                    var geolocateControl = new tt.GeolocateControl({
                        positionOptions: {
                            enableHighAccuracy: false
                        }
                    });

                    bindEvents();

                    // Handle case when domain permissions are already blocked
                    handlePermissionDenied();

                    map.addControl(geolocateControl);

                    function handlePermissionDenied() {
                        if ('permissions' in navigator) {
                            navigator.permissions.query({ name: 'geolocation' })
                                .then(function (result) {
                                    if (result.state === 'denied') {
                                        displayErrorMessage(messages.permissionDenied);
                                    }
                                });
                        }
                    }

                    function bindEvents() {
                        geolocateControl.on('error', handleError);
                        messageBoxClose.addEventListener('click', handleMessageBoxClose);
                    }

                    function handleMessageBoxClose() {
                        messageBox.setAttribute('hidden', true);
                    }

                    function displayErrorMessage(message) {
                        messageBoxContent.textContent = message;
                        messageBox.removeAttribute('hidden');
                    }

                    function handleError(error) {
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                displayErrorMessage(messages.permissionDenied);
                                break;
                            case error.POSITION_UNAVAILABLE:
                            case error.TIMEOUT:
                                displayErrorMessage(messages.notAvailable);
                        }
                    }
                </script>
 
            </div>
        </div>
    </section>
    <!-- End Projects Section -->
</body>
</html>
